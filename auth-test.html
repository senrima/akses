<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Tes Minimalis ke GAS</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; }
        button { font-size: 1.2rem; padding: 10px 20px; }
        pre { background-color: #eee; padding: 1rem; border: 1px solid #ccc; }
    </style>
</head>
<body>

    <h1>Uji Coba Koneksi Minimalis</h1>
    <p>Halaman ini hanya akan melakukan satu panggilan API ke endpoint `/auth/v1` dengan token yang sudah ditentukan.</p>
    <button id="testBtn">Jalankan Tes</button>
    
    <h2>Hasil di Console:</h2>
    <pre id="resultArea">Buka Developer Tools (F12) dan lihat tab "Console" untuk hasil detail...</pre>

    <script>
        // =======================================================
        //                 KONFIGURASI PENTING
        // =======================================================
        
        // 1. Ganti dengan URL Worker Anda
        const workerUrl = 'https://akses.s-tools.id/auth/v1';

        // 2. PENTING: Ganti dengan token yang VALID dan BELUM KADALUWARSA dari sheet 'Pengguna' Anda.
        const testToken = 'GANTI_DENGAN_TOKEN_ASLI_YANG_VALID';

        // =======================================================

        const testBtn = document.getElementById('testBtn');
        const resultArea = document.getElementById('resultArea');

        async function runTest() {
            console.clear(); // Membersihkan console setiap kali tes dijalankan
            resultArea.textContent = "Menjalankan tes... Cek tab Console (F12).";
            console.log("Mengirim permintaan ke:", workerUrl);

            try {
                const response = await fetch(workerUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'verify_token',
                        data: {
                            token: testToken
                        }
                    })
                });

                console.log("Menerima respons dari server:", response);

                // Coba untuk mem-parsing respons sebagai JSON
                const result = await response.json();

                // Jika berhasil, tampilkan hasilnya
                console.log("SUKSES! Data JSON diterima:", result);
                resultArea.textContent = "SUKSES!\n\n" + JSON.stringify(result, null, 2);
                resultArea.style.borderColor = 'green';

            } catch (error) {
                // JIKA GAGAL PARSING JSON, INI AKAN DIJALANKAN
                console.error("GAGAL! Terjadi error saat parsing JSON:", error);
                
                // Tambahan: Coba ambil respons sebagai teks untuk melihat apa isinya
                try {
                    // Kita buat ulang request untuk bisa membaca body-nya sebagai teks
                    const errorResponse = await fetch(workerUrl, {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'verify_token', data: { token: testToken } })
                    });
                    const errorText = await errorResponse.text();
                    console.error("RAW RESPONSE (Isi Asli):", errorText);
                    resultArea.textContent = `GAGAL! Error: ${error.message}\n\nRAW RESPONSE DARI SERVER (Ini adalah bukti masalahnya):\n\n${errorText}`;
                } catch (e) {
                    resultArea.textContent = `GAGAL! Error: ${error.message}. Tidak bisa mengambil Raw Response.`;
                }
                resultArea.style.borderColor = 'red';
            }
        }

        testBtn.addEventListener('click', runTest);
    </script>
</body>
</html>
